import{j as i,r as e,A as m,G as p}from"./index-B5N-jUy8.js";import{a as g,C as h,L as v}from"./TileLayer-ISEXnMHk.js";import{t as x}from"./index-CJ_zZ9Gs.js";import{c as A,b as C}from"./App-BP_5kTt-.js";const y=A(i.jsx("path",{d:"M12 10.9c-.61 0-1.1.49-1.1 1.1s.49 1.1 1.1 1.1c.61 0 1.1-.49 1.1-1.1s-.49-1.1-1.1-1.1M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m2.19 12.19L6 18l3.81-8.19L18 6z"}),"Explore"),R=(o=20)=>{const s=e.useRef(!1),[a,t]=e.useState(null),r=e.useMemo(()=>x(n=>{t(n)},Math.max(5,o)),[]);return e.useEffect(()=>{const n=c=>{c.absolute&&(s.current=!0),typeof c.webkitCompassHeading<"u"?r({degree:360-c.webkitCompassHeading,accuracy:c.webkitCompassAccuracy}):c.absolute===s.current&&r(c.alpha!==null?{degree:c.alpha,accuracy:0}:null)};return window.addEventListener("deviceorientationabsolute",n),window.addEventListener("deviceorientation",n),()=>{window.removeEventListener("deviceorientationabsolute",n),window.removeEventListener("deviceorientation",n)}},[]),a},E=()=>{const o=Promise.resolve("granted");return d&&typeof DeviceOrientationEvent<"u"&&typeof(DeviceOrientationEvent==null?void 0:DeviceOrientationEvent.requestPermission)=="function"?DeviceOrientationEvent.requestPermission():o},d=(()=>{try{return!!(navigator&&navigator.userAgent&&navigator.userAgent.includes("Safari/")&&!(navigator.userAgent.includes("Chrome/")||navigator.userAgent.includes("Chromium/")))}catch{return!1}})();(function(){var o=L.Marker.prototype._initIcon,s=L.Marker.prototype._setPos,a=L.DomUtil.TRANSFORM==="msTransform";L.Marker.addInitHook(function(){var t=this.options.icon&&this.options.icon.options,r=t&&this.options.icon.options.iconAnchor;r&&(r=r[0]+"px "+r[1]+"px"),this.options.rotationOrigin=this.options.rotationOrigin||r||"center bottom",this.options.rotationAngle=this.options.rotationAngle||0,this.on("drag",function(n){n.target._applyRotation()})}),L.Marker.include({_initIcon:function(){o.call(this)},_setPos:function(t){s.call(this,t),this._applyRotation()},_applyRotation:function(){this.options.rotationAngle&&(this._icon.style[L.DomUtil.TRANSFORM+"Origin"]=this.options.rotationOrigin,a?this._icon.style[L.DomUtil.TRANSFORM]="rotate("+this.options.rotationAngle+"deg)":this._icon.style[L.DomUtil.TRANSFORM]+=" rotateZ("+this.options.rotationAngle+"deg)")},setRotationAngle:function(t){return this.options.rotationAngle=t,this.update(),this},setRotationOrigin:function(t){return this.options.rotationOrigin=t,this.update(),this}})})();const k=e.forwardRef(({children:o,...s},a)=>{const t=e.useRef(null),r=R(100),[n,c]=e.useState(null);return e.useEffect(()=>{const l=f=>{try{const u=JSON.parse(f.data);(u==null?void 0:u.type)==="compass"&&c({degree:u.degree,accuracy:u.accuracy})}catch{}};return window.addEventListener("message",l),()=>{window.removeEventListener("message",l)}},[]),e.useEffect(()=>{c(r)},[r]),e.useEffect(()=>{const l=t.current;l&&n&&(l.setRotationAngle(360-n.degree),l.setRotationOrigin("center"))},[n]),n===null?i.jsx(i.Fragment,{}):i.jsx(g,{ref:l=>{t.current=l,a&&(a.current=l)},...s,children:o})}),j=()=>{const{geolocation:o,geoPermission:s}=e.useContext(m),a=e.useMemo(()=>O(),[]);return s!=="granted"?null:i.jsxs(i.Fragment,{children:[i.jsx(h,{center:p(o),radius:25}),i.jsx(k,{rotationOrigin:"center",icon:a,position:p(o)},"rotated-marker")]})},O=()=>v.divIcon({iconSize:[20,20],iconAnchor:[10,10],className:"self-center"}),P=()=>{const{compassPermission:o,setCompassPermission:s}=e.useContext(m),a=e.useCallback(()=>{E().then(t=>{s(t)})},[s]);return!d||o==="granted"?i.jsx(i.Fragment,{}):i.jsx("div",{className:"leaflet-bottom leaflet-right",children:i.jsx(C,{sx:w,className:"leaflet-control leaflet-bar",onClick:a,children:i.jsx(y,{sx:{p:"3px",color:"black"}})})})},w={background:"white",width:32,height:32,marginBottom:"57px !important",marginRight:"5px !important",display:"flex",justifyContent:"center",alignItems:"center"};export{P as C,j as S};
