import{r as a,A as y,B as I,e as A,l as M,j as p}from"./index-B5N-jUy8.js";import{b as P,L as B,S as D}from"./App-BP_5kTt-.js";import{C as O}from"./CircularProgress-Bi997K7R.js";const T=({stopKeys:i,disabled:l=!1})=>{const{db:{routeList:n,stopList:o,serviceDayMap:f},isVisible:x,refreshInterval:g,isRouteFilter:d,isTodayHoliday:E}=a.useContext(y),j=a.useMemo(()=>i.reduce((e,[r])=>e||r==="lightRail",!1),[i]),c=a.useMemo(()=>Object.entries(n).reduce((e,[r,{stops:t,freq:u}])=>(d&&!I(r,u,E,f)||i.forEach(([s,L])=>{var v;(v=t[s])==null||v.forEach((z,k)=>{z===L&&e.push([r,k])})}),e),[]).map(e=>e.join("|")).filter((e,r,t)=>t.indexOf(e)===r).map(e=>e.split("|")),[i,n,d,E,f]),[C,R]=a.useState([]),S=A(),m=a.useRef(!1),h=a.useCallback(()=>!x||l||navigator.userAgent==="prerendering"?(R([]),new Promise(e=>e([]))):Promise.all(c.map(([e,r])=>M({...n[e],seq:parseInt(r,10),stopList:o,language:S}))).then(e=>{m.current&&R(e.map((r,t)=>[c[t].join("/"),r.filter(({co:u,dest:s})=>u!=="mtr"?!0:s.zh===n[c[t][0]].dest.zh)]).sort(([r,t],[u,s])=>t.length===0?1:s.length===0?-1:j?t[0].remark.zh===s[0].remark.zh?t[0].eta<s[0].eta?-1:1:t[0].remark.zh<s[0].remark.zh?-1:1:t[0].eta===s[0].eta?r<u?-1:1:t[0].eta<s[0].eta?-1:1))}),[x,l,S,n,o,c,j]);return a.useEffect(()=>{m.current=!0;const e=setInterval(()=>{h()},g);return h(),()=>{m.current=!1,clearInterval(e)}},[h,g]),C},H=({stops:i,isFocus:l})=>{const n=T({stopKeys:i,disabled:!l});return n.length===0?p.jsx(P,{sx:b,children:p.jsx(O,{sx:{my:5}})}):p.jsx(B,{children:n.map(([o,f])=>p.jsx(D,{routeId:o,etas:f},o))})},b={display:"flex",flex:1,justifyContent:"center"};export{H as S};
